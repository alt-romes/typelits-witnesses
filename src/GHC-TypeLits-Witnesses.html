<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/GHC/TypeLits/Witnesses.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE TypeOperators #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE ConstraintKinds #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE PolyKinds #-}</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-comment'>-- |</span>
<a name="line-9"></a><span class='hs-comment'>-- Module      : GHC.TypeLits.Witnesses</span>
<a name="line-10"></a><span class='hs-comment'>-- Description : Instance witnesses for various arithmetic operations on</span>
<a name="line-11"></a><span class='hs-comment'>--               GHC TypeLits.</span>
<a name="line-12"></a><span class='hs-comment'>-- Copyright   : (c) Justin Le 2015</span>
<a name="line-13"></a><span class='hs-comment'>-- License     : MIT</span>
<a name="line-14"></a><span class='hs-comment'>-- Maintainer  : justin@jle.im</span>
<a name="line-15"></a><span class='hs-comment'>-- Stability   : unstable</span>
<a name="line-16"></a><span class='hs-comment'>-- Portability : non-portable</span>
<a name="line-17"></a><span class='hs-comment'>--</span>
<a name="line-18"></a><span class='hs-comment'>--</span>
<a name="line-19"></a><span class='hs-comment'>-- This module provides witnesses for instances that result from the</span>
<a name="line-20"></a><span class='hs-comment'>-- various arithmetic operations on GHC TypeLits 'Nat' types.  In general,</span>
<a name="line-21"></a><span class='hs-comment'>-- if you have @'KnownNat' n@, GHC can't infer @'KnownNat' (n + 1)@; and if</span>
<a name="line-22"></a><span class='hs-comment'>-- you have @'KnownNat' m@, as well, GHC can't infer @'KnownNat' (n + m)@.</span>
<a name="line-23"></a><span class='hs-comment'>--</span>
<a name="line-24"></a><span class='hs-comment'>-- This can be extremely annoying when dealing with libraries and</span>
<a name="line-25"></a><span class='hs-comment'>-- applications where one regularly adds and subtracts type-level nats and</span>
<a name="line-26"></a><span class='hs-comment'>-- expects 'KnownNat' instances to follow.  For example, vector</span>
<a name="line-27"></a><span class='hs-comment'>-- concatenation of length-encoded vector types can be:</span>
<a name="line-28"></a><span class='hs-comment'>--</span>
<a name="line-29"></a><span class='hs-comment'>-- @</span>
<a name="line-30"></a><span class='hs-comment'>-- concat :: ('KnownNat' n, 'KnownNat' m) =&gt; Vector n a -&gt; Vector m a -&gt; Vector (n + m) a</span>
<a name="line-31"></a><span class='hs-comment'>-- @</span>
<a name="line-32"></a><span class='hs-comment'>--</span>
<a name="line-33"></a><span class='hs-comment'>-- But, now @n + m@ does not have a 'KnownNat' instance...which makes</span>
<a name="line-34"></a><span class='hs-comment'>-- operations like this extremely less useful!</span>
<a name="line-35"></a><span class='hs-comment'>--</span>
<a name="line-36"></a><span class='hs-comment'>-- At the highest level, this module can be used with 'withNatOp':</span>
<a name="line-37"></a><span class='hs-comment'>--</span>
<a name="line-38"></a><span class='hs-comment'>-- @</span>
<a name="line-39"></a><span class='hs-comment'>-- getDoubled :: forall n. 'KnownNat' n =&gt; 'Proxy' n -&gt; 'Integer'</span>
<a name="line-40"></a><span class='hs-comment'>-- getDoubled p = 'withNatOp' ('%*') p ('Proxy' :: 'Proxy' 2) $</span>
<a name="line-41"></a><span class='hs-comment'>--     natVal ('Proxy' :: 'Proxy' (n * 2))</span>
<a name="line-42"></a><span class='hs-comment'>-- @</span>
<a name="line-43"></a><span class='hs-comment'>--</span>
<a name="line-44"></a><span class='hs-comment'>-- With the final argument of 'withNatOp', you can provide a result</span>
<a name="line-45"></a><span class='hs-comment'>-- computed in an environment where @n * 2@ is indeed an instance of</span>
<a name="line-46"></a><span class='hs-comment'>-- 'KnownNat'.</span>
<a name="line-47"></a><span class='hs-comment'>--</span>
<a name="line-48"></a><span class='hs-comment'>-- For more complex usage, you can directly manipulate witnesses and then</span>
<a name="line-49"></a><span class='hs-comment'>-- use them via pattern matching:</span>
<a name="line-50"></a><span class='hs-comment'>--</span>
<a name="line-51"></a><span class='hs-comment'>-- @</span>
<a name="line-52"></a><span class='hs-comment'>-- let pn = 'natDict' ('Proxy' :: 'Proxy' n)</span>
<a name="line-53"></a><span class='hs-comment'>--     p1 = 'natDict' ('Proxy' :: 'Proxy' 1)</span>
<a name="line-54"></a><span class='hs-comment'>--     p2 = 'natDict' ('Proxy' :: 'Proxy' 2)</span>
<a name="line-55"></a><span class='hs-comment'>-- in  case pn '%*' p2 '%+' p1 of</span>
<a name="line-56"></a><span class='hs-comment'>--       'Dict' -&gt; 'natVal' ('Proxy' :: 'Proxy' (n * 2 + 1))</span>
<a name="line-57"></a><span class='hs-comment'>-- @</span>
<a name="line-58"></a><span class='hs-comment'>--</span>
<a name="line-59"></a><span class='hs-comment'>-- In the branch of the case statement, @n * 2 + 1@ indeed has a 'KnownNat'</span>
<a name="line-60"></a><span class='hs-comment'>-- instance.</span>
<a name="line-61"></a><span class='hs-comment'>--</span>
<a name="line-62"></a><span class='hs-comment'>-- Note that the operators have appropriate fixities to mimic value-level</span>
<a name="line-63"></a><span class='hs-comment'>-- arithmetic operations.</span>
<a name="line-64"></a><span class='hs-comment'>--</span>
<a name="line-65"></a><span class='hs-comment'>-- __WARNING__: '%-' and 'entailSub' are is implemented in a way such</span>
<a name="line-66"></a><span class='hs-comment'>-- that /negative/ 'KnownNat's are produced without any errors.  The</span>
<a name="line-67"></a><span class='hs-comment'>-- production of witnesses and entailments will hold, but be aware that any</span>
<a name="line-68"></a><span class='hs-comment'>-- functions that rely on 'KnownNat' instances to be non-negative can</span>
<a name="line-69"></a><span class='hs-comment'>-- potentially break.</span>
<a name="line-70"></a>
<a name="line-71"></a>
<a name="line-72"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>TypeLits</span><span class='hs-varop'>.</span><span class='hs-conid'>Witnesses</span> <span class='hs-layout'>(</span>
<a name="line-73"></a>  <span class='hs-comment'>-- * High level wrapper</span>
<a name="line-74"></a>    <span class='hs-varid'>withNatOp</span>
<a name="line-75"></a>  <span class='hs-comment'>-- * Direct witnesses</span>
<a name="line-76"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>natDict</span>
<a name="line-77"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>dictNatVal</span>
<a name="line-78"></a>  <span class='hs-comment'>-- * Witness generators</span>
<a name="line-79"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>%+</span><span class='hs-layout'>)</span>
<a name="line-80"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>%-</span><span class='hs-layout'>)</span>
<a name="line-81"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>%*</span><span class='hs-layout'>)</span>
<a name="line-82"></a>  <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>%^</span><span class='hs-layout'>)</span>
<a name="line-83"></a>  <span class='hs-comment'>-- * Entailments</span>
<a name="line-84"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>entailAdd</span>
<a name="line-85"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>entailSub</span>
<a name="line-86"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>entailMul</span>
<a name="line-87"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>entailExp</span>
<a name="line-88"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-89"></a>
<a name="line-90"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Constraint</span>
<a name="line-91"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>TypeLits</span>
<a name="line-92"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Proxy</span>
<a name="line-93"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Reflection</span>
<a name="line-94"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Unsafe</span><span class='hs-varop'>.</span><span class='hs-conid'>Coerce</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="natDict"></a><span class='hs-comment'>-- | Create a 'Dict' witness for @'KnownNat' n@.</span>
<a name="line-97"></a><span class='hs-definition'>natDict</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-98"></a><span class='hs-definition'>natDict</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Dict</span>
<a name="line-99"></a>
<a name="line-100"></a><a name="dictNatVal"></a><span class='hs-comment'>-- | Get the 'Integer' from the 'KnownNat' instance witnessed by the</span>
<a name="line-101"></a><span class='hs-comment'>-- 'Dict'.</span>
<a name="line-102"></a><span class='hs-definition'>dictNatVal</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span><span class='hs-varop'>.</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Integer</span>
<a name="line-103"></a><span class='hs-definition'>dictNatVal</span> <span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-104"></a>
<a name="line-105"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>6</span> <span class='hs-varop'>%+</span>
<a name="line-106"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>6</span> <span class='hs-varop'>%-</span>
<a name="line-107"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>7</span> <span class='hs-varop'>%*</span>
<a name="line-108"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>8</span> <span class='hs-varop'>%^</span>
<a name="line-109"></a>
<a name="line-110"></a><a name="%25+"></a><span class='hs-comment'>-- | Given witnesses for @'KnownNat' n@ and @'KnownNat' m@, generates</span>
<a name="line-111"></a><span class='hs-comment'>-- a witness for @'KnownNat' (n + m)@.</span>
<a name="line-112"></a><span class='hs-comment'>--</span>
<a name="line-113"></a><span class='hs-comment'>-- Follows proper association and fixity for usage with other similar</span>
<a name="line-114"></a><span class='hs-comment'>-- operators.</span>
<a name="line-115"></a><span class='hs-layout'>(</span><span class='hs-varop'>%+</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-116"></a><span class='hs-conid'>Dict</span> <span class='hs-varop'>%+</span> <span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapDict</span> <span class='hs-varid'>entailAdd</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-117"></a>
<a name="line-118"></a><a name="%25-"></a><span class='hs-comment'>-- | Given witnesses for @'KnownNat' n@ and @'KnownNat' m@, generates</span>
<a name="line-119"></a><span class='hs-comment'>-- a witness for @'KnownNat' (n - m)@.</span>
<a name="line-120"></a><span class='hs-comment'>--</span>
<a name="line-121"></a><span class='hs-comment'>-- Note that this is implemented in a way such that /negative/ 'KnownNat's</span>
<a name="line-122"></a><span class='hs-comment'>-- are produced without any errors.</span>
<a name="line-123"></a><span class='hs-comment'>--</span>
<a name="line-124"></a><span class='hs-comment'>-- Follows proper association and fixity for usage with other similar</span>
<a name="line-125"></a><span class='hs-comment'>-- operators.</span>
<a name="line-126"></a><span class='hs-layout'>(</span><span class='hs-varop'>%-</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-comment'>-</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-127"></a><span class='hs-conid'>Dict</span> <span class='hs-varop'>%-</span> <span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapDict</span> <span class='hs-varid'>entailSub</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-128"></a>
<a name="line-129"></a><a name="%25*"></a><span class='hs-comment'>-- | Given witnesses for @'KnownNat' n@ and @'KnownNat' m@, generates</span>
<a name="line-130"></a><span class='hs-comment'>-- a witness for @'KnownNat' (n * m)@.</span>
<a name="line-131"></a><span class='hs-comment'>--</span>
<a name="line-132"></a><span class='hs-comment'>-- Follows proper association and fixity for usage with other similar</span>
<a name="line-133"></a><span class='hs-comment'>-- operators.</span>
<a name="line-134"></a><span class='hs-layout'>(</span><span class='hs-varop'>%*</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>*</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-135"></a><span class='hs-conid'>Dict</span> <span class='hs-varop'>%*</span> <span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapDict</span> <span class='hs-varid'>entailMul</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-136"></a>
<a name="line-137"></a><a name="%25%5e"></a><span class='hs-comment'>-- | Given witnesses for @'KnownNat' n@ and @'KnownNat' m@, generates</span>
<a name="line-138"></a><span class='hs-comment'>-- a witness for @'KnownNat' (n ^ m)@.</span>
<a name="line-139"></a><span class='hs-comment'>--</span>
<a name="line-140"></a><span class='hs-comment'>-- Follows proper association and fixity for usage with other similar</span>
<a name="line-141"></a><span class='hs-comment'>-- operators.</span>
<a name="line-142"></a><span class='hs-layout'>(</span><span class='hs-varop'>%^</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>^</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-143"></a><span class='hs-conid'>Dict</span> <span class='hs-varop'>%^</span> <span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapDict</span> <span class='hs-varid'>entailExp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-144"></a>
<a name="line-145"></a><a name="withNatOp"></a><span class='hs-comment'>-- | A high-level the interface of this module.  Give it one of</span>
<a name="line-146"></a><span class='hs-comment'>-- the witness-generating operators on 'KnownNat's in this module ('%+',</span>
<a name="line-147"></a><span class='hs-comment'>-- '%-', '%*', or '%^'), two 'Proxy's containing the 'KnownNat's to</span>
<a name="line-148"></a><span class='hs-comment'>-- be modified, and receive an environment where the result of the</span>
<a name="line-149"></a><span class='hs-comment'>-- operation (applied to the 'KnownNat's) has a 'KnownNat' instance.</span>
<a name="line-150"></a><span class='hs-comment'>--</span>
<a name="line-151"></a><span class='hs-comment'>-- For example, with</span>
<a name="line-152"></a><span class='hs-comment'>--</span>
<a name="line-153"></a><span class='hs-comment'>-- @</span>
<a name="line-154"></a><span class='hs-comment'>-- 'withNatOp' ('%+') ('Proxy' :: 'Proxy' n) ('Proxy' :: 'Proxy' 1) r</span>
<a name="line-155"></a><span class='hs-comment'>-- @</span>
<a name="line-156"></a><span class='hs-comment'>--</span>
<a name="line-157"></a><span class='hs-comment'>-- in @r@, @n + 1@ has a 'KnownNat' instance:</span>
<a name="line-158"></a><span class='hs-comment'>--</span>
<a name="line-159"></a><span class='hs-comment'>-- @</span>
<a name="line-160"></a><span class='hs-comment'>-- 'withNatOp' ('%+') ('Proxy' :: 'Proxy' n) ('Proxy' :: 'Proxy' 1) $</span>
<a name="line-161"></a><span class='hs-comment'>--     'natVal' ('Proxy' :: 'Proxy' (n + 1))</span>
<a name="line-162"></a><span class='hs-comment'>-- -- =&gt; will return the 'Integer' correpsonding to n + 1</span>
<a name="line-163"></a><span class='hs-comment'>-- @</span>
<a name="line-164"></a><span class='hs-comment'>--</span>
<a name="line-165"></a><span class='hs-comment'>-- Normally, if @n@ is a 'KnownNat' instance, it is not in general</span>
<a name="line-166"></a><span class='hs-comment'>-- inferrable that @n + 1@ also has a 'KnownNat' instance.  This combinator</span>
<a name="line-167"></a><span class='hs-comment'>-- makes it so.</span>
<a name="line-168"></a><span class='hs-comment'>--</span>
<a name="line-169"></a><span class='hs-comment'>-- For multiple operations on values, this can be chained:</span>
<a name="line-170"></a><span class='hs-comment'>--</span>
<a name="line-171"></a><span class='hs-comment'>-- @</span>
<a name="line-172"></a><span class='hs-comment'>-- 'withNatOp' ('%*') ('Proxy' :: 'Proxy' n) ('Proxy' :: 'Proxy' 2) $</span>
<a name="line-173"></a><span class='hs-comment'>--   'withNatOp' ('%+') ('Proxy' :: 'Proxy' (n*2)) ('Proxy' :: 'Proxy' 1) $</span>
<a name="line-174"></a><span class='hs-comment'>--     'natVal' ('Proxy' :: 'Proxy' (n * 2 + 1))</span>
<a name="line-175"></a><span class='hs-comment'>-- @</span>
<a name="line-176"></a><span class='hs-comment'>--</span>
<a name="line-177"></a><span class='hs-comment'>-- But, at this point, it's easier and simpler to just directly use the</span>
<a name="line-178"></a><span class='hs-comment'>-- operators and pattern match:</span>
<a name="line-179"></a><span class='hs-comment'>--</span>
<a name="line-180"></a><span class='hs-comment'>-- @</span>
<a name="line-181"></a><span class='hs-comment'>-- let pn = 'natDict' ('Proxy' :: 'Proxy' n)</span>
<a name="line-182"></a><span class='hs-comment'>--     p1 = 'natDict' ('Proxy' :: 'Proxy' 1)</span>
<a name="line-183"></a><span class='hs-comment'>--     p2 = 'natDict' ('Proxy' :: 'Proxy' 2)</span>
<a name="line-184"></a><span class='hs-comment'>-- in  case pn '%*' p2 '%+' p1 of</span>
<a name="line-185"></a><span class='hs-comment'>--       'Dict' -&gt; 'natVal' ('Proxy' :: 'Proxy' (n * 2 + 1))</span>
<a name="line-186"></a><span class='hs-comment'>-- @</span>
<a name="line-187"></a><span class='hs-comment'>--</span>
<a name="line-188"></a><span class='hs-comment'>-- (Note that associativity and fixity for the witness-generating operators</span>
<a name="line-189"></a><span class='hs-comment'>-- are set to match that of normal addition and multiplication, etc.)</span>
<a name="line-190"></a><span class='hs-comment'>--</span>
<a name="line-191"></a><span class='hs-comment'>--</span>
<a name="line-192"></a><span class='hs-definition'>withNatOp</span>
<a name="line-193"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-194"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dict</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>q</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-195"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span>
<a name="line-196"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>m</span>
<a name="line-197"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>q</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-198"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-199"></a><span class='hs-definition'>withNatOp</span> <span class='hs-varid'>op</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>natDict</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`op`</span> <span class='hs-varid'>natDict</span> <span class='hs-varid'>y</span> <span class='hs-keyword'>of</span>
<a name="line-200"></a>                       <span class='hs-conid'>Dict</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>r</span>
<a name="line-201"></a>
<a name="line-202"></a><a name="entailAdd"></a><span class='hs-comment'>-- | An entailment for addition of 'KnownNat' instances.</span>
<a name="line-203"></a><span class='hs-definition'>entailAdd</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-conop'>:-</span> <span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-204"></a><span class='hs-definition'>entailAdd</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Sub</span> <span class='hs-varop'>$</span>
<a name="line-205"></a>  <span class='hs-varid'>reifyNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varop'>+</span> <span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-206"></a>    <span class='hs-varid'>unsafeCoerce</span> <span class='hs-layout'>(</span><span class='hs-varid'>natDict</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-207"></a>
<a name="line-208"></a><a name="entailSub"></a><span class='hs-comment'>-- | An entailment for subtraction of 'KnownNat' instances.</span>
<a name="line-209"></a><span class='hs-comment'>--</span>
<a name="line-210"></a><span class='hs-comment'>-- Note that this is implemented in a way such that /negative/ 'KnownNat's</span>
<a name="line-211"></a><span class='hs-comment'>-- are produced without any errors.</span>
<a name="line-212"></a><span class='hs-definition'>entailSub</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-conop'>:-</span> <span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-comment'>-</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-213"></a><span class='hs-definition'>entailSub</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Sub</span> <span class='hs-varop'>$</span>
<a name="line-214"></a>  <span class='hs-varid'>reifyNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-comment'>-</span> <span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-215"></a>    <span class='hs-varid'>unsafeCoerce</span> <span class='hs-layout'>(</span><span class='hs-varid'>natDict</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-216"></a>
<a name="line-217"></a><a name="entailMul"></a><span class='hs-comment'>-- | An entailment for multiplication of 'KnownNat' instances.</span>
<a name="line-218"></a><span class='hs-definition'>entailMul</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-conop'>:-</span> <span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>*</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-219"></a><span class='hs-definition'>entailMul</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Sub</span> <span class='hs-varop'>$</span>
<a name="line-220"></a>  <span class='hs-varid'>reifyNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varop'>*</span> <span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-221"></a>    <span class='hs-varid'>unsafeCoerce</span> <span class='hs-layout'>(</span><span class='hs-varid'>natDict</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-222"></a>
<a name="line-223"></a><a name="entailExp"></a><span class='hs-comment'>-- | An entailment for exponentiation of 'KnownNat' instances.</span>
<a name="line-224"></a><span class='hs-definition'>entailExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>n</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>KnownNat</span> <span class='hs-varid'>n</span><span class='hs-layout'>,</span> <span class='hs-conid'>KnownNat</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-conop'>:-</span> <span class='hs-conid'>KnownNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>^</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-225"></a><span class='hs-definition'>entailExp</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Sub</span> <span class='hs-varop'>$</span>
<a name="line-226"></a>  <span class='hs-varid'>reifyNat</span> <span class='hs-layout'>(</span><span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varop'>^</span> <span class='hs-varid'>natVal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-227"></a>    <span class='hs-varid'>unsafeCoerce</span> <span class='hs-layout'>(</span><span class='hs-varid'>natDict</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-228"></a>
</pre></body>
</html>
